<turbo-frame id="main_content">
  <div class="container my-5">

    <!-- Header: image left, info right -->
    <div class="row g-4 align-items-start mb-4">
      <div class="col-md-4">
        <% primary_photo = @restaurant.photos.attached? ? @restaurant.photos.first : nil %>
        <% if primary_photo %>
          <%= image_tag primary_photo,
                class: "img-fluid rounded shadow-sm w-100",
                style: "height: 220px; object-fit: cover;" %>
        <% else %>
          <%= image_tag "default_avatar.png",
                class: "img-fluid rounded shadow-sm w-100",
                style: "height: 220px; object-fit: cover;" %>
        <% end %>
      </div>

      <div class="col-md-8">
        <h1 class="fw-bold mb-2"><%= @restaurant.name %></h1>
        <dl class="row text-muted mb-0">
          <dt class="col-sm-3"><i class="bi bi-tag-fill me-1"></i> category:</dt>
          <dd class="col-sm-9"><%= @restaurant.category.presence || "‚Äî" %></dd>

          <dt class="col-sm-3"><i class="bi bi-geo-alt-fill me-1"></i> address:</dt>
          <dd class="col-sm-9"><%= @restaurant.address.presence || "‚Äî" %></dd>

          <dt class="col-sm-3"><i class="bi bi-clock-fill me-1"></i> opening hours:</dt>
          <dd class="col-sm-9"><%= @restaurant.opening_hours.presence || "‚Äî" %></dd>
        </dl>
      </div>
    </div>

    <hr class="my-4">

    <!-- Body: recommendations left, map right -->
    <div class="row g-4">
    <div class="col-lg-7">
      <h3 class="mb-3">üçΩ Recommendations</h3>

      <% if @recommendations.present? %>
        <div class="list-group shadow-sm rounded overflow-hidden">
          <% @recommendations.each do |recommendation| %>
            <div class="list-group-item">
              <p class="mb-1"><%= recommendation.description %></p>
              <small class="text-muted">
                ‚Äî Recommended by
                <%= link_to(recommendation.user.username, user_path(recommendation.user)) if recommendation.user %>
              </small>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-muted fst-italic mb-0">No recommendations yet.</p>
      <% end %>

      <hr class="my-4">

      <h3 class="mb-3">üì∏ Photos</h3>
      <% if @rec_photos.any? %>
        <div class="row g-2">
          <% @rec_photos.first(12).each do |photo| %>
            <div class="col-4 col-md-3">
              <div class="ratio ratio-4x3 rounded overflow-hidden">
                <%= image_tag photo,
                              class: "w-100 h-100",
                              style: "object-fit: cover;",
                              loading: "lazy",
                              decoding: "async" %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-muted fst-italic mb-0">No photos yet.</p>
      <% end %>
    </div>
      <div class="col-lg-5">
        <h3 class="mb-3">üó∫ Map</h3>
          <div
            data-controller="map"
            data-map-markers-value='<%= @markers.to_json %>'
            data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>"
            class="rounded shadow-sm" style="height: 350px;">
          </div>
      </div>
    </div>

  </div>
</turbo-frame>
