<nav class="navbar navbar-light bg-light fixed-bottom border-top" data-controller="bottom-nav">
  <div class="container-fluid justify-content-around align-items-center nav-icons">

    <% home_active     = current_page?(root_path) %>
    <% map_active      = current_page?(map_path) %>
    <% post_active     = controller_name == "recommendations" && action_name == "new" %>
    <% wishlist_active = request.path.starts_with?(wishlists_path) %>
    <% profile_active  = current_user && current_page?(user_path(current_user)) %>
    <% signin_active   = !current_user && current_page?(new_user_session_path) %>

    <!-- Home -->
    <%= link_to root_path,
                class: "nav-link #{home_active ? 'is-active is-home' : ''}",
                aria: { label: "Home", current: (home_active ? 'page' : nil) },
                title: "Home" do %>
      ‚åÇ
    <% end %>

    <!-- Explore / Map -->
    <%= link_to map_path,
                data: { turbo_frame: "main_content", turbo_action: 'advance' },
                class: "nav-link #{map_active ? 'is-active' : ''}",
                aria: { label: "Explore", current: (map_active ? 'page' : nil) },
                title: "Explore" do %>
      <%= map_active ? "‚ú¶" : "‚åñ" %>
    <% end %>

    <!-- New Post -->
    <%= link_to new_recommendation_path,
                data: { turbo_frame: "main_content", turbo_action: 'advance' },
                class: "nav-plus #{post_active ? 'nav-plus--active' : ''}",
                aria: { label: "New post", current: (post_active ? 'page' : nil) },
                title: "New post" do %>
      <span class="nav-plus__glyph">Ôºã</span>
    <% end %>

    <!-- Wishlist -->
    <%= link_to wishlists_path,
                data: { turbo_frame: "main_content", turbo_action: 'advance' },
                class: "nav-link #{wishlist_active ? 'is-active' : ''}",
                aria: { label: "Wishlist", current: (wishlist_active ? 'page' : nil) },
                title: "Wishlist" do %>
      <%= wishlist_active ? "‚ô•" : "‚ô°" %>
    <% end %>

    <!-- Profile -->
    <% if current_user %>
      <%= link_to user_path(current_user),
                  data: { turbo_frame: "main_content", turbo_action: 'advance' },
                  class: "nav-link p-0 #{profile_active ? 'is-active' : ''}",
                  aria: { label: "Profile", current: (profile_active ? 'page' : nil) },
                  title: "Profile" do %>
        <% if current_user.profile_picture.attached? %>
          <%= image_tag current_user.profile_picture,
                        class: "rounded-circle nav-avatar #{profile_active ? 'avatar-active' : ''}",
                        size: "28x28",
                        alt: current_user.username %>
        <% else %>
          <%= image_tag "https://i.pravatar.cc/100?u=#{current_user.id}",
                        class: "rounded-circle nav-avatar #{profile_active ? 'avatar-active' : ''}",
                        size: "28x28",
                        alt: current_user.username %>
        <% end %>
      <% end %>
    <% else %>
      <%= link_to new_user_session_path,
                  class: "nav-link #{signin_active ? 'is-active' : ''}",
                  aria: { label: "Sign in", current: (signin_active ? 'page' : nil) },
                  title: "Sign in" do %>
        üë§
      <% end %>
    <% end %>

  </div>

  <style>
    /* Base size for text icons */
    .nav-icons { font-size: 1.35rem; }

    /* Links */
    .nav-link  { color:#6c757d; text-decoration:none; opacity:.88; transition: color .15s ease, opacity .15s ease, text-underline-offset .15s; }
    .nav-link:hover, .nav-link:focus { opacity:1; text-decoration: underline; text-underline-offset: .2em; }
    .nav-link.is-active { color:#212529; font-weight:600; opacity:1; text-decoration:none; }

    /* Home active: subtle ‚Äúpill‚Äù underline to anchor it */
    .nav-link.is-home.is-active { position:relative; }
    .nav-link.is-home.is-active::after{
      content:""; position:absolute; left:50%; transform:translateX(-50%);
      bottom:-6px; width:18px; height:3px; border-radius:3px; background:#212529;
    }

    /* Plus button */
    .nav-plus{
      width:36px; height:36px; border:1.5px solid #212529; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      color:#212529; text-decoration:none; transition: all .15s ease;
      background:#fff;
    }
    .nav-plus:hover{ box-shadow: 0 2px 6px rgba(0,0,0,.08); }
    /* Active: filled dot with white plus */
    .nav-plus--active{ background:#212529; color:#fff; border-color:#212529; }
    .nav-plus__glyph{ line-height:1; font-size:1.05em; }

    /* Avatar */
    .nav-avatar{ display:block; width:28px; height:28px; object-fit:cover; border:1px solid rgba(0,0,0,.08); }
    .avatar-active{ box-shadow: 0 0 0 2px #212529 inset; }

    /* Improve tap targets slightly on all items */
    .nav-link, .nav-plus { padding: .2rem .35rem; border-radius: .4rem; }
  </style>
</nav>
