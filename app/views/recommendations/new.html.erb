<turbo-frame id="main_content">
  <div class="container mt-5 mb-5 d-flex justify-content-center">
    <div class="card shadow-lg p-2 mx-auto" style="max-width: 1000px; width: 100%;">
      <div class="card-body text-center">
        <% if @restaurant.present? %>
          <h1>New Recommendation for <%= @restaurant.name %></h1>
          <%= form_with model: [@restaurant, @recommendation], data: { turbo: false }, local: true do |form| %>
            <div>
              <%= form.label :description %>
              <%= form.text_area :description %>
            </div>
            <div>
              <%= form.label :restaurant_tags %>
              <%= form.text_field :restaurant_tags %>
            </div>
            <div>
              <%= form.submit "Create Recommendation" %>
            </div>
          <% end %>
        <% else %>
          <h1 class="mb-4">Share a Restaurant With Your Friends!</h1>
          <%= form_with model: @recommendation, data: { turbo: false }, local: true do |form| %>
            <!-- Photo Upload Boxes -->
            <div class="mb-3" data-controller="preview">
              <label class="form-label fw-bold">Upload Photos</label>
              <div class="d-flex justify-content-center gap-3">
                <% 4.times do |i| %>
                  <div class="photo-box position-relative" data-preview-target="box">
                    <%= form.file_field :photos,
                      accept: "image/*",
                      class: "d-none",
                      multiple: false,
                      name: "recommendation[photos][]",
                      data: {
                        preview_target: "input",
                        action: "change->preview#showPreview",
                        index: i
                      } %>
                    <div class="photo-placeholder plus">
                      <span>+</span>
                    </div>
                    <div class="remove-btn" data-action="click->preview#removePhoto">x</div>
                    <img data-preview-target="image" class="preview-img d-none" />
                  </div>
                <% end %>
              </div>
            </div>
            <!-- Restaurant Autocomplete Search -->
            <div class="mb-3 position-relative"
                data-controller="autocomplete"
                data-autocomplete-url-value="/restaurants.json">
              <%= form.label :restaurant_name, "Select a Restaurant", class: "form-label fw-bold" %>
              <%= form.text_field :restaurant_name,
                    value: @prefill_restaurant_name,
                    data: { autocomplete_target: "input" },
                    class: "form-control",
                    placeholder: "Type to search for restaurants...",
                    autocomplete: "off" %>
              <%= form.hidden_field :restaurant_id,
                    value: @recommendation.restaurant_id,
                    data: { autocomplete_target: "hidden" } %>
              <div data-autocomplete-target="results"
                  class="list-group position-absolute w-100"
                  style="z-index: 100;"></div>
            </div>
            <!-- Description/Review -->
            <div class="mb-3">
              <%= form.label :description, class: "form-label fw-bold" %>
              <%= form.text_area :description, rows: 4,
                    class: "form-control",
                    placeholder: "Write your recommendation here..." %>
            </div>
            <!-- Tags -->
            <div class="form-group mb-3">
              <%= form.label :tag_ids, "Tags", class: "font-bold" %>
              <select multiple class="tag-select w-full" data-controller="tags" name="recommendation[tag_ids][]">
                <optgroup label="Cuisine">
                  <option value="Japanese">Japanese</option>
                  <option value="Italian">Italian</option>
                  <option value="Mexican">Mexican</option>
                  <option value="Thai">Thai</option>
                  <option value="French">French</option>
                </optgroup>
                <optgroup label="Mood">
                  <option value="Cozy">Cozy</option>
                  <option value="Romantic">Romantic</option>
                  <option value="Casual">Casual</option>
                  <option value="Trendy">Trendy</option>
                  <option value="Family-friendly">Family-friendly</option>
                </optgroup>
                <optgroup label="Features">
                  <option value="Rooftop">Rooftop</option>
                  <option value="Live Music">Live Music</option>
                  <option value="Mobile Ordering">Mobile Ordering</option>
                  <option value="Private Rooms">Private Rooms</option>
                </optgroup>
              </select>
            </div>
            <!-- Submit -->
            <div>
              <%= form.submit "Share!", class: "btn btn-primary" %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</turbo-frame>
